generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model bundle_price_version {
  id         Int        @id @default(autoincrement())
  bundle_id  Int
  version    Int
  price      Decimal    @db.Decimal(10, 2)
  created_at DateTime?  @default(now()) @db.Timestamp(6)
  bundles    bundle     @relation(fields: [bundle_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  purchase   purchase[]

  @@unique([bundle_id, version])
}

model product_price_version {
  id         Int        @id @default(autoincrement())
  product_id Int
  version    Int
  price      Decimal    @db.Decimal(10, 2)
  created_at DateTime?  @default(now()) @db.Timestamp(6)
  products   product    @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  purchase   purchase[]

  @@unique([product_id, version])
}

model account {
  id            Int        @id @default(autoincrement())
  handle_name   String     @unique @db.VarChar(50)
  display_name  String     @db.VarChar(50)
  password_hash String
  email         String     @unique @db.VarChar(100)
  created_at    DateTime?  @default(now()) @db.Timestamp(6)
  purchase      purchase[]
}

model bundle {
  id                   Int                    @id @default(autoincrement())
  name                 String                 @db.VarChar(100)
  description          String?
  created_at           DateTime?              @default(now()) @db.Timestamp(6)
  bundle_item          bundle_item[]
  bundle_price_version bundle_price_version[]
  purchase             purchase[]
}

model bundle_item {
  bundle_id  Int
  product_id Int
  bundle     bundle  @relation(fields: [bundle_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product    product @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([bundle_id, product_id])
}

model product {
  id                    Int                     @id @default(autoincrement())
  name                  String                  @db.VarChar(100)
  description           String?
  category              String?                 @db.VarChar(50)
  created_at            DateTime?               @default(now()) @db.Timestamp(6)
  bundle_item           bundle_item[]
  product_price_version product_price_version[]
  purchase              purchase[]
}

model purchase {
  id                    Int                    @id @default(autoincrement())
  account_id            Int
  is_bundle             Boolean?               @default(false)
  product_id            Int?
  product_version       Int?
  bundle_id             Int?
  bundle_version        Int?
  amount                Decimal                @db.Decimal(10, 2)
  purchase_status       String?                @default("pending") @db.VarChar(20)
  created_at            DateTime?              @default(now()) @db.Timestamp(6)
  updated_at            DateTime?              @default(now()) @db.Timestamp(6)
  bundle_price_version  bundle_price_version?  @relation(fields: [bundle_id, bundle_version], references: [bundle_id, version], onDelete: NoAction, onUpdate: NoAction, map: "fk_bundle_version")
  product_price_version product_price_version? @relation(fields: [product_id, product_version], references: [product_id, version], onDelete: NoAction, onUpdate: NoAction, map: "fk_product_version")
  account               account                @relation(fields: [account_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  bundle                bundle?                @relation(fields: [bundle_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  product               product?               @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}
